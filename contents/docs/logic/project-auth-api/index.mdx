---
title: "Configuraci√≥n de Cognito y API"
description: "Este archivo detalla la configuraci√≥n de Amazon Cognito, la integraci√≥n de proveedores de identidad externos, la creaci√≥n de clientes de API y otros elementos de infraestructura, incluyendo rutas y funciones Lambda, para un sistema de autenticaci√≥n y gesti√≥n de usuarios."
keywords: "Cognito, API, Lambda, DynamoDB, autenticaci√≥n, proveedores de identidad, Google, configuraci√≥n, infraestructura"
---

## Introducci√≥n

Este archivo tiene como objetivo proporcionar una gu√≠a detallada de la configuraci√≥n del sistema de autenticaci√≥n y gesti√≥n de usuarios utilizando **Amazon Cognito** y servicios relacionados. En el proceso, se abordan aspectos clave como la creaci√≥n y configuraci√≥n de **User Pools**, la integraci√≥n con **proveedores de identidad externos** (como Google), el establecimiento de **grupos de usuarios**, la gesti√≥n de **tokens JWT** para seguridad en las rutas de la API y la creaci√≥n de funciones **Lambda** para gestionar los datos de los usuarios. Adem√°s, se configura una tabla **DynamoDB** para el almacenamiento eficiente de la informaci√≥n de los usuarios.

La implementaci√≥n descrita a continuaci√≥n est√° dise√±ada para brindar flexibilidad, escalabilidad y seguridad al sistema, permitiendo una integraci√≥n fluida de los usuarios y su informaci√≥n en las aplicaciones que lo utilicen.

---

### üßë‚Äçüíª **Configuraci√≥n de Cognito User Pool**

El **User Pool** de **Amazon Cognito** gestiona la informaci√≥n de los usuarios registrados en la aplicaci√≥n.

| Par√°metro             | Descripci√≥n                                                                                                                                                               |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **userPoolName**      | Nombre del User Pool. El nombre incluye el entorno (stage), como `ProjectAuthApiUserPool-${stage}`.                                                                       |
| **selfSignUpEnabled** | Habilita el auto-registro de usuarios.                                                                                                                                    |
| **signInAliases**     | Permite el inicio de sesi√≥n con el **email** o **nombre de usuario**.                                                                                                     |
| **autoVerify**        | Configura la verificaci√≥n autom√°tica del **email** al registrarse.                                                                                                        |
| **userVerification**  | Personaliza el correo de verificaci√≥n que se env√≠a al usuario con un c√≥digo.                                                                                              |
| **passwordPolicy**    | Configura la pol√≠tica de contrase√±as, que requiere un m√≠nimo de 8 caracteres y al menos una letra may√∫scula.                                                              |
| **customAttributes**  | Define atributos personalizados como `groups`, `phone`, `role`, `organization`, `country`, `city`, y `terms` que pueden usarse para gestionar la informaci√≥n del usuario. |

---

### üîë **Proveedor de Identidad Externa (Google)**

El **Proveedor de Identidad de Google** permite a los usuarios iniciar sesi√≥n con sus cuentas de Google.

| Par√°metro            | Descripci√≥n                                                                                                              |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| **clientId**         | El ID de cliente de Google, que depende del entorno (producci√≥n o staging).                                              |
| **clientSecret**     | El secreto del cliente de Google, que tambi√©n depende del entorno.                                                       |
| **scopes**           | Define los permisos que se solicitan a Google, como `email`, `profile`, `openid`, y `phone`.                             |
| **attributeMapping** | Mapea los atributos de Google a los atributos del User Pool de Cognito, como `preferredUsername`, `email`, y `fullname`. |

---

### üßë‚Äçüíª **Clientes de la API (AppClient)**

El **AppClient** es utilizado para interactuar con el **User Pool** desde una aplicaci√≥n externa.

| Par√°metro                      | Descripci√≥n                                                                                                                                              |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **userPoolClientName**         | Nombre del cliente de la aplicaci√≥n, como `BasicAppClient-${stage}`.                                                                                     |
| **authFlows**                  | Habilita flujos de autenticaci√≥n, como el flujo de contrase√±a de usuario y el flujo SRP (Secure Remote Password).                                        |
| **oAuth**                      | Configura el flujo de autorizaci√≥n de **OAuth**, habilitando los permisos necesarios y las URLs de redirecci√≥n y cierre de sesi√≥n para la autenticaci√≥n. |
| **preventUserExistenceErrors** | Evita errores cuando un usuario ya existe en el pool de usuarios.                                                                                        |
| **accessTokenValidity**        | Establece la validez del token de acceso, en este caso de 60 minutos.                                                                                    |
| **refreshTokenValidity**       | Establece la validez del token de actualizaci√≥n, en este caso de 30 d√≠as.                                                                                |
| **supportedIdentityProviders** | Especifica los proveedores de identidad soportados, como **Cognito** y **Google**.                                                                       |

---

### üë• **Grupos de Usuarios**

Se crean grupos de usuarios para categorizar a los usuarios seg√∫n sus roles.

| Grupo                  | Descripci√≥n                                                              |
| ---------------------- | ------------------------------------------------------------------------ |
| **ProjectEvaluator**   | Grupo para usuarios que revisan las respuestas de los proyectos.         |
| **ProjectContributor** | Grupo para usuarios que responden preguntas del proyecto.                |
| **ProjectArchitect**   | Grupo para usuarios responsables de estructurar y construir el proyecto. |

---

### üåê **Dominio Cognito**

Se configura un dominio para la autenticaci√≥n de Cognito con un prefijo personalizado seg√∫n el entorno.

| Par√°metro        | Descripci√≥n                                                      |
| ---------------- | ---------------------------------------------------------------- |
| **domainPrefix** | Prefijo del dominio Cognito, que cambia dependiendo del entorno. |

---

### üóÉÔ∏è **Tabla DynamoDB para Usuarios**

Se configura una tabla **DynamoDB** para almacenar la informaci√≥n de los usuarios.

| Par√°metro                | Descripci√≥n                                                                                       |
| ------------------------ | ------------------------------------------------------------------------------------------------- |
| **partitionKey**         | Clave primaria para la tabla, en este caso `pk`.                                                  |
| **sortKey**              | Clave de ordenaci√≥n para la tabla, en este caso `sk`.                                             |
| **globalSecondaryIndex** | Se a√±aden √≠ndices secundarios globales para mejorar las consultas.                                |
| **billingMode**          | Modo de facturaci√≥n, configurado como **PAY_PER_REQUEST**.                                        |
| **removalPolicy**        | Pol√≠tica de eliminaci√≥n, configurada para destruir la tabla en staging y retenerla en producci√≥n. |

---

### üõ†Ô∏è **Lambda Function para Usuarios**

Se configura una **Lambda Function** para gestionar las operaciones relacionadas con los usuarios.

| Par√°metro       | Descripci√≥n                                                                      |
| --------------- | -------------------------------------------------------------------------------- |
| **runtime**     | Establece el entorno de ejecuci√≥n, en este caso **Node.js 18.x**.                |
| **entry**       | Especifica el archivo de entrada de la funci√≥n Lambda, `lambda/User.handler.ts`. |
| **environment** | Variables de entorno, en este caso la tabla de DynamoDB `TABLE_NAME`.            |

---

### üîë **Autorizaci√≥n JWT para API**

Se configura un **Autorizador JWT** para proteger las rutas de la API.

| Par√°metro          | Descripci√≥n                                                                             |
| ------------------ | --------------------------------------------------------------------------------------- |
| **identitySource** | Define el encabezado **Authorization** como fuente de identidad.                        |
| **jwtAudience**    | Define la audiencia del JWT, que debe coincidir con el ID del cliente de la aplicaci√≥n. |

---

### üåê **Configuraci√≥n de Rutas HTTP API**

Se crean rutas en la API para gestionar las operaciones de usuarios.

| Ruta            | M√©todo   | Descripci√≥n                                |
| --------------- | -------- | ------------------------------------------ |
| **/user**       | **POST** | Ruta para crear un nuevo usuario.          |
| **/user/`{one}`** | **PUT**  | Ruta para actualizar un usuario existente. |
| **/users**      | **GET**  | Ruta para obtener una lista de usuarios.   |

---

Con esta configuraci√≥n, tu sistema de autenticaci√≥n y gesti√≥n de usuarios estar√° listo para interactuar con aplicaciones de forma segura y eficiente. Esta arquitectura escalable es adecuada tanto para entornos de producci√≥n como de desarrollo.
